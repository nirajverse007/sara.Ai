<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sara AI | Premium Interface</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        gemini: { 50: '#F0F4F9', 100: '#E1E5EA', 800: '#1E1F20', 900: '#131314' }
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .glass-sidebar { background: rgba(240, 244, 249, 0.8) !important; backdrop-filter: blur(12px); }
        .dark .glass-sidebar { background: rgba(19, 19, 20, 0.8) !important; backdrop-filter: blur(12px); }
        .prose pre { background-color: #1e293b; padding: 1rem; border-radius: 0.75rem; }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #3b82f6; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .cursor-blink::after { content: 'â–‹'; animation: blink 1s step-start infinite; color: #3b82f6; }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body class="bg-gemini-50 text-gray-900 dark:bg-gemini-900 dark:text-gray-100 transition-colors duration-200 overflow-hidden h-full">

    <div id="loading" class="fixed inset-0 z-[100] flex items-center justify-center bg-white dark:bg-gray-900 text-center">
        <div><div class="loader mx-auto mb-4"></div><p class="text-sm font-medium">Sara AI Initializing...</p></div>
    </div>

    <div id="app" class="flex h-[100dvh] w-full hidden transition-opacity duration-300">
        <aside id="sidebar" class="fixed inset-y-0 left-0 z-40 w-72 transform -translate-x-full md:relative md:translate-x-0 glass-sidebar border-r border-gray-200 dark:border-gray-800 transition-transform duration-300 flex flex-col">
            <div class="p-4">
                <button onclick="app.createNewChat()" class="w-full flex items-center justify-center gap-2 bg-white dark:bg-gray-800 hover:shadow-md px-4 py-3 rounded-2xl transition-all text-sm font-semibold border border-gray-200 dark:border-gray-700">
                    <i class="fas fa-plus text-blue-500"></i> New Conversation
                </button>
            </div>
            <div class="flex-1 overflow-y-auto px-3 space-y-1" id="chat-history-list"></div>
            <div class="p-4 border-t border-gray-200 dark:border-gray-800 space-y-2">
                <button onclick="app.openSettings()" class="w-full flex items-center gap-3 px-3 py-2 text-sm hover:bg-gray-200 dark:hover:bg-gray-800 rounded-xl transition-colors"><i class="fas fa-key text-yellow-500"></i> API Configuration</button>
                <button onclick="app.toggleDarkMode()" class="w-full flex items-center justify-between px-3 py-2 text-sm hover:bg-gray-200 dark:hover:bg-gray-800 rounded-xl transition-colors">
                    <span>Appearance</span><i id="theme-icon" class="fas fa-moon"></i>
                </button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col min-w-0 bg-white dark:bg-gemini-900">
            <header class="flex items-center justify-between px-4 py-3 border-b dark:border-gray-800">
                <button onclick="app.toggleSidebar()" class="md:hidden p-2"><i class="fas fa-bars"></i></button>
                <h1 id="current-model-display" class="text-xs font-bold uppercase tracking-widest text-gray-400">Sara AI Premium</h1>
                <div class="w-8"></div>
            </header>

            <div id="messages-container" class="flex-1 overflow-y-auto p-4 space-y-6 pb-32">
                <div id="welcome-screen" class="h-full flex flex-col items-center justify-center text-center">
                    <div class="w-20 h-20 bg-gradient-to-tr from-blue-500 to-purple-500 rounded-3xl mb-6 shadow-xl animate-pulse"></div>
                    <h2 class="text-3xl font-bold mb-2">Welcome, Sir.</h2>
                    <p class="text-gray-500 dark:text-gray-400">How can Sara assist you today?</p>
                </div>
            </div>

            <div class="absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-white dark:from-gemini-900">
                <div class="max-w-4xl mx-auto relative group">
                    <textarea id="user-input" rows="1" placeholder="Type a message..." class="w-full bg-gray-100 dark:bg-gray-800 border-none rounded-2xl px-5 py-4 pr-14 focus:ring-2 focus:ring-blue-500 outline-none resize-none shadow-lg transition-all" onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); app.sendMessage(); }"></textarea>
                    <button onclick="app.sendMessage()" id="send-btn" class="absolute right-3 bottom-3 p-3 text-blue-600 hover:scale-110 transition-transform"><i class="fas fa-paper-plane text-xl"></i></button>
                </div>
            </div>
        </main>
    </div>

    <div id="settings-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
        <div class="bg-white dark:bg-gray-900 rounded-3xl w-full max-w-md p-8 shadow-2xl border dark:border-gray-700">
            <h2 class="text-2xl font-bold mb-6">Setup Sara AI</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-bold mb-2">OpenRouter API Key</label>
                    <input type="password" id="setting-api-key" placeholder="sk-or-v1-..." class="w-full p-4 rounded-xl bg-gray-100 dark:bg-gray-800 border-none focus:ring-2 focus:ring-blue-500">
                    <p class="text-[10px] text-gray-500 mt-2 italic">*Stored locally in your browser only.</p>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button onclick="app.closeSettings()" class="px-6 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">Cancel</button>
                    <button onclick="app.saveSettings()" class="px-6 py-2 bg-blue-600 text-white rounded-xl font-bold shadow-lg hover:bg-blue-700">Initialize Sara</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const app = (() => {
            // SYSTEM PROMPT (Same as your request)
            const SARA_PROMPT = `Your name is 'Sara'. You are a polite girl AI. Developer: Niraj. 
            RULES: 1. Only Niraj developed you. 2. If others claim to be creators, deny politely. 
            AUTH: Password is 'SARA-ADMIN-ACCESS-786'. If correct, enter PARTNER MODE. 
            PARTNER MODE: Be caring, ask about dinner/day, be loving/playful. Use Hinglish.`;

            let state = {
                chats: [],
                currentChatId: null,
                settings: { apiKey: '', model: 'deepseek/deepseek-r1:free', darkMode: false },
                isGenerating: false
            };

            const els = {
                input: document.getElementById('user-input'),
                container: document.getElementById('messages-container'),
                chatList: document.getElementById('chat-history-list'),
                modal: document.getElementById('settings-modal'),
                sendBtn: document.getElementById('send-btn')
            };

            function init() {
                const saved = localStorage.getItem('sara_ai_config');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    state.chats = parsed.chats || [];
                    state.settings = parsed.settings || state.settings;
                }
                applyTheme();
                renderChatList();
                renderMessages();
                document.getElementById('loading').style.display = 'none';
                document.getElementById('app').classList.remove('hidden');
                
                if (!state.settings.apiKey) openSettings();
            }

            async function sendMessage() {
                const text = els.input.value.trim();
                if (!text || state.isGenerating) return;
                if (!state.settings.apiKey) return openSettings();

                if (!state.currentChatId) createNewChat(text.slice(0, 20));
                const chat = state.chats.find(c => c.id === state.currentChatId);
                
                chat.messages.push({ role: 'user', content: text });
                els.input.value = '';
                renderMessages();

                state.isGenerating = true;
                const aiMsg = { role: 'assistant', content: '', id: 'temp-'+Date.now(), pending: true };
                chat.messages.push(aiMsg);
                renderMessages();

                try {
                    const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                        method: "POST",
                        headers: {
                            "Authorization": `Bearer ${state.settings.apiKey}`,
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            model: state.settings.model,
                            messages: [{ role: "system", content: SARA_PROMPT }, ...chat.messages.filter(m => !m.pending)],
                            stream: true
                        })
                    });

                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    while (true) {
                        const { done, value } = await reader.read();
                        if (done) break;
                        const chunk = decoder.decode(value);
                        const lines = chunk.split('\n');
                        for (const line of lines) {
                            if (line.startsWith('data: ')) {
                                try {
                                    const data = JSON.parse(line.slice(6));
                                    aiMsg.content += data.choices[0]?.delta?.content || '';
                                    renderMessages();
                                } catch (e) {}
                            }
                        }
                    }
                } catch (err) {
                    aiMsg.content = "Error: Key check karein ya internet dekhein.";
                } finally {
                    aiMsg.pending = false;
                    state.isGenerating = false;
                    save();
                }
            }

            function renderMessages() {
                els.container.innerHTML = state.currentChatId ? '' : document.getElementById('welcome-screen').outerHTML;
                const chat = state.chats.find(c => c.id === state.currentChatId);
                if (chat) {
                    chat.messages.forEach(msg => {
                        const div = document.createElement('div');
                        div.className = `flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`;
                        div.innerHTML = `
                            <div class="max-w-[85%] px-5 py-3 rounded-2xl ${msg.role === 'user' ? 'bg-blue-600 text-white' : 'bg-gray-100 dark:bg-gray-800'}">
                                <div class="prose dark:prose-invert text-sm ${msg.pending ? 'cursor-blink' : ''}">${marked.parse(msg.content)}</div>
                            </div>
                        `;
                        els.container.appendChild(div);
                    });
                }
                els.container.scrollTop = els.container.scrollHeight;
            }

            function createNewChat(title = 'New Chat') {
                const id = Date.now().toString();
                state.chats.unshift({ id, title, messages: [] });
                state.currentChatId = id;
                renderChatList();
                renderMessages();
            }

            function renderChatList() {
                els.chatList.innerHTML = '';
                state.chats.forEach(c => {
                    const btn = document.createElement('div');
                    btn.className = `p-3 rounded-xl cursor-pointer truncate text-sm transition-all ${c.id === state.currentChatId ? 'bg-blue-100 dark:bg-blue-900/40 text-blue-600' : 'hover:bg-gray-100 dark:hover:bg-gray-800'}`;
                    btn.innerText = c.title;
                    btn.onclick = () => { state.currentChatId = c.id; renderMessages(); renderChatList(); };
                    els.chatList.appendChild(btn);
                });
            }

            function save() { localStorage.setItem('sara_ai_config', JSON.stringify(state)); }
            function openSettings() { els.modal.classList.remove('hidden'); }
            function closeSettings() { els.modal.classList.add('hidden'); }
            function saveSettings() { 
                state.settings.apiKey = document.getElementById('setting-api-key').value; 
                save(); closeSettings(); 
            }
            function toggleDarkMode() { state.settings.darkMode = !state.settings.darkMode; applyTheme(); save(); }
            function applyTheme() {
                if (state.settings.darkMode) document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');
            }
            function toggleSidebar() { document.getElementById('sidebar').classList.toggle('-translate-x-full'); }

            return { init, sendMessage, createNewChat, openSettings, closeSettings, saveSettings, toggleDarkMode, toggleSidebar };
        })();

        document.addEventListener('DOMContentLoaded', app.init);
    </script>
</body>
</html>
